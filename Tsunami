-- ============================================
-- MzD Hub v13.0 — Module Loader (Delta-Safe)
-- Loadstring - loadstring(game:HttpGet("https://raw.githubusercontent.com/mzdtools/EBFTTEST/main/Tsunami"))()
-- ============================================
local BASE_URL = "https://raw.githubusercontent.com/mzdtools/EBFTTEST/main/modules/"
local moduleNames = {
    "globals",
    "workspace_init",
    "remote_discovery",
    "settings",
    "state",
    "wall_themes",
    "utility",
    "base_detection",
    "doom_collector",
    "god_mode",
    "movement",
    "rarity_filter",
    "plot_actions",
    "slot_helpers",
    "factory",
    "farming",
    "firefice",
    "tower_trial",
    "tower_trial_hud",
    "lucky_blocks",
    "money_collector",
    "auto_upgrade",
    "anti_afk",
    "instant_pickup",
    "valentine",
    "arcade",
    "map_fixer",
    "respawn_handler",
    "gui",
    "status_loop",
    "startup",
    "etc",
    "etc2",
}
local Modules = {}
-- Phase 1: Load all module tables with retry logic
-- Delta sometimes has HttpGet delays/failures
for _, name in ipairs(moduleNames) do
    local url = BASE_URL .. name .. ".lua"
    local result = nil
    local loaded = false
    for attempt = 1, 3 do
        local ok, res = pcall(function()
            local source = game:HttpGet(url)
            if not source or source == "" or #source < 10 then
                error("Empty response")
            end
            -- Delta fix: check for HTML error pages
            if source:sub(1, 1) == "<" then
                error("Got HTML instead of Lua")
            end
            return loadstring(source)()
        end)
        if ok and res then
            result = res
            loaded = true
            break
        else
            warn("[MzD Hub] Attempt " .. attempt .. "/3 failed for: " .. name .. " — " .. tostring(res))
            task.wait(1) -- wait before retry
        end
    end
    if loaded and result then
        Modules[name] = result
    else
        warn("[MzD Hub] FAILED to load module: " .. name)
        Modules[name] = { init = function() end }
    end
end
-- Phase 2: Initialize modules in order
for _, name in ipairs(moduleNames) do
    if name ~= "globals" then
        local mod = Modules[name]
        if mod and mod.init then
            local ok, err = pcall(function()
                mod.init(Modules)
            end)
            if not ok then
                warn("[MzD Hub] Error initializing: " .. name .. " — " .. tostring(err))
            end
        end
    end
end
print("[MzD Hub] All modules loaded successfully.")
